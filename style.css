:root{
  --bg:#76a49b; --leaf:#bfe3c0; --panel:#ffffffcc; --card:#e8f3ea;
  --text:#274432; --muted:#6b8f7a; --accent:#7cc79a; --accent-dark:#55b07f;
  --good:#4cc08a; --bad:#f18a7e; --gold:#e7b35a; --border:#d7e7d9;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%} body{margin:0;color:var(--text);
  font-family:ui-rounded,SF Pro Rounded,system-ui,-apple-system,Segoe UI,Roboto,PingFang SC,Noto Sans CJK SC,sans-serif}

#app{min-height:100vh;display:flex;flex-direction:column}

.hud{position:sticky;top:0;z-index:10;display:flex;align-items:center;
  justify-content:space-between;padding:10px 12px;background:var(--panel);
  backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
.hud .stats{display:flex;gap:12px;color:var(--gold);font-weight:700}
.hud .day{font-weight:800}
.btn{border:none;border-radius:16px;padding:10px 14px;font-weight:800;
  color:#1f3b2c;background:var(--gold);cursor:pointer;box-shadow:0 2px 0 #caa24e}
.btn:disabled{opacity:.55;cursor:not-allowed;box-shadow:none}
.btn-ghost{background:#ffffff; color:#2a5a40; border:1px solid var(--border); box-shadow:none}
.btn-primary{background:var(--accent);color:#0b2016;box-shadow:0 2px 0 var(--accent-dark)}
.hidden{display:none}

.goalbar{padding:8px 12px; background:#ffffffcc; border-bottom:1px solid var(--border)}
.goal-line{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.goal-text{font-weight:800}
.goal-progress{display:grid;grid-template-columns:110px 1fr;align-items:center;gap:8px;margin:6px 0}
.gp-wrap{height:12px;background:#eaf6ee;border:1px solid #d9ecdf;border-radius:999px;overflow:hidden}
.gp{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#9fe0bb)}

.screen{display:none;flex:1;flex-direction:column;padding:12px 12px 24px;gap:12px}
.screen.active{display:flex}
.title{margin:8px 0 4px;font-size:22px;font-weight:900}
.sub{margin:0;color:var(--muted)}
.card-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:8px}
.recruit-card{background:var(--card);border:1px solid var(--border);border-radius:20px;
  padding:12px;display:flex;flex-direction:column;gap:6px;box-shadow:0 2px 0 #dfeee3}
.recruit-card .row{display:flex;align-items:center;justify-content:space-between}
.tag{padding:3px 10px;border-radius:999px;background:#e6f5ea;color:#2e6b4e;font-size:12px;border:1px solid var(--border)}
.attr{display:flex;gap:6px;font-size:12px;color:var(--muted)}
.card-actions{display:flex;gap:8px;margin-top:6px}
.small{font-size:12px;color:var(--muted)}
.recruit-footer{position:sticky;bottom:0;padding-top:8px;
  background:linear-gradient(180deg, rgba(255,255,255,0) 0, rgba(255,255,255,1) 24px)}

.ip-bar{display:flex;gap:8px;overflow:auto;padding-bottom:2px}
.ip-pill{flex:0 0 auto;background:#ffffff;border:1px solid var(--border);
  border-radius:999px;padding:6px 10px;display:flex;align-items:center;gap:6px;cursor:pointer;box-shadow:0 2px 0 #dfeee3}
.ip-pill.active{outline:2px solid var(--accent)}
.ip-pill .meta{font-size:12px;color:var(--muted)}

.card-area{position:relative;flex:1;display:flex;align-items:center;justify-content:center}
.choice-card{position:relative;width:min(92vw,420px);aspect-ratio:3/4;border-radius:28px;
  touch-action:pan-y;user-select:none;box-shadow:0 6px 0 #dfeee3;
  overflow:hidden;border:1px solid var(--border); background:#000}
.card-media{position:absolute;inset:0}
.card-video{width:100%;height:100%;object-fit:cover}
.card-fallback{position:absolute;inset:0;background:#cfe5d5 url('assets/bg.png') center/cover no-repeat}

.card-core{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;
  text-align:center;padding:16px;pointer-events:none}
.card-prompt{margin-top:8px;font-weight:900;color:#ffffff;text-shadow:0 1px 2px rgba(0,0,0,.35);font-size:20px}
.card-title{margin-top:6px;font-size:16px;font-weight:900;color:#ffffff;text-shadow:0 1px 2px rgba(0,0,0,.35)}
.card-desc{margin-top:6px;font-size:14px;color:#eef7f1;text-shadow:0 1px 2px rgba(0,0,0,.35)}





.upgrade-panel{display:none;gap:8px;margin-top:18px;flex-wrap:wrap;justify-content:center;pointer-events:auto}
.upgrade-panel.show{display:flex}
.attr-btn{border:none;border-radius:12px;padding:10px 14px;font-weight:900;cursor:pointer;
  background:rgba(255,255,255,.9); border:1px solid var(--border); color:#214235}

.progress-wrap{height:14px;background:#eef7f1;border-radius:999px;border:1px solid var(--border);overflow:hidden}
.progress{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#b8ebcd)}
.toast{position:fixed;left:50%;bottom:18px;transform:translateX(-50%);
  background:#ffffff;border:1px solid var(--border);color:var(--text);padding:10px 14px;
  border-radius:12px;opacity:0;pointer-events:none;transition:opacity .2s;box-shadow:0 2px 0 #dfeee3}
.toast.show{opacity:1}

.footer-bar{display:flex;align-items:center;justify-content:space-between;gap:12px}
.footer-info{color:var(--muted)}
.btn-upgrade-mini{background:var(--accent);color:#133525;border:none;border-radius:12px;padding:8px 12px;font-weight:900}

@media (max-width:360px){.card-grid{grid-template-columns:1fr}}


/* === UI Polish 2.8 === */
.progress{position:relative; height:100%; width:0;
  background:linear-gradient(90deg, var(--accent) 0%, #2ec27e 50%, #1fa45d 100%);
  transition:width .2s ease-out;
}
.progress.running::after{
  content:''; position:absolute; inset:0;
  background:repeating-linear-gradient(45deg, rgba(255,255,255,.25) 0 8px, rgba(255,255,255,0) 8px 16px);
  animation:stripe-move 1s linear infinite;
}
@keyframes stripe-move{ to{ background-position:32px 0; } }

/* Bigger, punchier HUD counters on change */
.hud-pop{animation:pop-scale .6s cubic-bezier(.2,1,.2,1)}
@keyframes pop-scale{ 0%{transform:scale(1)} 20%{transform:scale(1.3)} 100%{transform:scale(1)} }

/* Big gain splash */
.gain-layer{position:fixed; inset:0; pointer-events:none; z-index:999}
.gain-float{position:absolute; font-weight:900; font-size:18px; padding:6px 10px;
  border-radius:999px; background:#fff; border:1px solid var(--border); box-shadow:0 8px 24px rgba(0,0,0,.08);
  opacity:0; transform:translateY(0);
  animation:float-up 1.2s ease-out forwards;
}
@keyframes float-up{ 10%{opacity:1} 100%{opacity:0; transform:translateY(-36px)} }

.gain-splash{position:fixed; left:50%; top:42%; transform:translate(-50%,-50%);
  font-weight:900; font-size:28px; color:#103a27; background:#ffffffea; border:1px solid var(--border);
  padding:14px 18px; border-radius:18px; box-shadow:0 10px 30px rgba(0,0,0,.12); opacity:0; z-index:1000;
  animation:splash-pop .9s cubic-bezier(.2,1,.2,1) forwards;
}
@keyframes splash-pop{ 0%{transform:translate(-50%,-50%) scale(.8); opacity:0} 30%{opacity:1} 100%{transform:translate(-50%,-50%) scale(1); opacity:0} }

/* Choice committed overlay */
.choice-card.committed::before{
  content:'已选择 ✓'; position:absolute; left:50%; top:12%; transform:translateX(-50%);
  font-weight:900; font-size:18px; color:#0a3b27; background:#ffffffd8; border:1px solid var(--border);
  padding:6px 10px; border-radius:999px; z-index:6;
}
.choice-card.committed .badge-left,
.choice-card.committed 

/* Day done banner */
.day-done{position:sticky; top:48px; z-index:9; margin:6px 12px; padding:10px 12px;
  background:#e9fff2; border:1px dashed #97e3b8; color:#0d3a26; border-radius:12px; font-weight:800; display:none;
}
.day-done.show{display:block}

/* Mark IP pills that finished today */
.ip-pill.done{opacity:.6; position:relative}
.ip-pill.done::after{content:'已行动'; position:absolute; right:10px; top:8px; font-size:12px; color:#2b6a4a; background:#e7f9ef; border:1px solid var(--border);
  padding:2px 6px; border-radius:999px; font-weight:800}

/* Pulse next day button when all done */
.btn.pulse, .btn-primary.pulse, #nextDayBtn.pulse{animation:btn-pulse 1s ease-in-out infinite}
@keyframes btn-pulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.05)} }


/* ==== FIX: Badge overlap & robustness ==== */
.choice-card .badge-left, .choice-card 
/* Optional: place badges lower on small screens */
@media (max-width: 360px){
  .choice-card .badge-left, .choice-card 
}


/* Align text to avoid visual collision */
.choice-card 
.choice-card 


/* ==== Choice badges & descriptions: multiline + auto-height ==== */
:root{
  --choice-badge-font-size: 16px;
  --choice-badge-pad-y: 10px;
  --choice-badge-pad-x: 12px;
  --choice-badge-radius: 16px;
  --choice-badge-top: 10px;
  --choice-badge-gap: 40px;       /* middle gap so left/right never overlap */
  --choice-badge-area: 10px;     /* reserve vertical space for wrapped badges */
}
.choice-card .badge-left,
.choice-card .badge-right{
  position:absolute;
  top: var(--choice-badge-top);
  z-index: 5;
  font-weight: 900;
  font-size: var(--choice-badge-font-size);
  padding: var(--choice-badge-pad-y) var(--choice-badge-pad-x);
  border-radius: var(--choice-badge-radius);
  border: 1px solid rgba(255,255,255,.65);
  background: rgba(255,255,255,.90);
  backdrop-filter: blur(2px);
  width: calc(50% - var(--choice-badge-gap));
  box-sizing: border-box;
/* multiline */
  white-space: normal;
  line-height: 1.25;
  word-break: break-word;
  overflow-wrap: anywhere;
  color: #1e2f28;
}
.choice-card .badge-left{ left: 8px; text-align:left; }
.choice-card .badge-right{ right: 8px; text-align:right; }

/* Push down the core content so badges above won't cover it */
.card-core{
  position: absolute;
  inset: 0;
  padding: calc(var(--choice-badge-area)) 16px 16px 16px !important;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  text-align: center;
  pointer-events: none;
}

/* Split descriptions below title */
.card-desc-row{
  width: 100%;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-top: 6px;
  color: #eef7f1;
  text-shadow: 0 1px 2px rgba(0,0,0,.35);
}
.card-desc-row .desc-left,
.card-desc-row .desc-right{
  font-size: 14px;
  line-height: 1.35;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.25);
  border-radius: 10px;
  padding: 6px 8px;
}
.card-desc-row .desc-left{ text-align: left; }
.card-desc-row .desc-right{ text-align: right; }

/* Small devices: slightly smaller badges & reserved area */
@media (max-width: 360px){
  :root{
    --choice-badge-font-size: 18px;
    --choice-badge-pad-y: 8px;
    --choice-badge-pad-x: 10px;
    --choice-badge-area: 138px;
  }
}


/* ===== Equal-width left/right badges with a center gap ===== */
:root{
  --choice-badge-gap: 32px; /* center gap; adjust as needed */
}
.choice-card .badge-row{
  position: absolute;
  top: var(--choice-badge-top, 10px);
  left: 8px;
  right: 8px;
  display: flex;
  gap: var(--choice-badge-gap);
  align-items: flex-start;
}
.choice-card .badge-left,
.choice-card .badge-right{
  position: relative;
  left: auto; right: auto;
  width: auto;
  flex: 1 1 0;
  max-width: none;
  box-sizing: border-box;
  white-space: normal;
  line-height: 1.25;
  word-break: break-word;
  overflow-wrap: anywhere;
}
.choice-card .badge-left{ text-align:left; }
.choice-card .badge-right{ text-align:right; }


/* ===== Predicted effect meter ===== */
.meter{ display:inline-block; margin-top:4px; padding:2px 6px; border-radius:8px; font-weight:800; font-size:12px; }
.meter-hot{ color:#064e3b; background:rgba(16,185,129,.85); }   /* 深绿字，浅绿底 */
.meter-good{ color:#1e3a8a; background:rgba(96,165,250,.85); }  /* 深蓝字，浅蓝底 */
.meter-neutral{ color:#111827; background:rgba(243,244,246,.85);}/* 深灰字，浅灰底 */
.meter-bad{ color:#7f1d1d; background:rgba(248,113,113,.85);}   /* 深红字，浅红底 */


/* ===== Clean override: equal halves + big rounded pill buttons ===== */
:root{
  --choice-badge-gap: 32px;
  --choice-badge-top: 10px;
  --choice-badge-font-size: 22px;
  --choice-badge-pad-y: 10px;
  --choice-badge-pad-x: 14px;
  --choice-badge-area: 120px;
}
.card-core{ padding-top: var(--choice-badge-area) !important; }
.choice-card .badge-row{
  position: absolute; top: var(--choice-badge-top); left: 8px; right: 8px;
  display: flex; gap: var(--choice-badge-gap); align-items: stretch; z-index:5;
}
.choice-card .badge-left, .choice-card .badge-right{
  position: relative; left:auto; right:auto; flex: 1 1 0; width:auto; max-width:none; box-sizing:border-box;
  font-weight:900; font-size: var(--choice-badge-font-size);
  padding: var(--choice-badge-pad-y) var(--choice-badge-pad-x);
  border-radius: 20px; background: rgba(255,255,255,.95);
  border: 1px solid rgba(255,255,255,.65); backdrop-filter: blur(2px); color: #1e2f28;
  white-space: normal; line-height: 1.25; word-break: break-word; overflow-wrap: anywhere;
}
.choice-card .badge-left{ text-align:left; }
.choice-card .badge-right{ text-align:right; }
